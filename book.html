<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Books Management</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <style>
      body {
        background-color: #f8f9fa;
      }
      .btn-light {
        background-color: #ffffff;
        color: #007bff;
      }
      .nav-link.active {
        background-color: #007bff;
        color: white;
      }
      table th,
      table td {
        vertical-align: middle;
      }
    </style>
  </head>
  <body>
    <div class="container py-5">
      <h1 class="text-uppercase text-center text-primary">Books</h1>

      <div class="d-flex gap-1">
        <a class="nav-link btn btn-primary text-white p-2" href="book.html"
          >Books</a
        >
        <a class="nav-link btn btn-primary text-white p-2" href="visitor.html"
          >Visitors</a
        >
        <a class="nav-link btn btn-primary text-white p-2" href="card.html"
          >Cards</a
        >
      </div>
      <!-- Add Book Button -->
      <div class="row py-3">
        <div
          class="col-md-12 bg-primary text-white p-3 rounded d-flex justify-content-between align-items-center"
        >
          <h5 class="m-0">All Books</h5>
          <button
            class="btn btn-light btn-sm"
            id="addBookButton"
            data-bs-toggle="modal"
            data-bs-target="#addBookModal"
          >
            Add New Book
          </button>
        </div>
      </div>

      <!-- Book Search and Sort -->
      <div class="card p-3 shadow-sm">
        <div class="d-flex mb-3">
          <input
            type="text"
            id="searchBook"
            class="form-control"
            placeholder="Search by name, author, or publisher..."
          />
          <button class="btn btn-secondary" id="sortBook">Sort</button>
        </div>
        <table class="table table-hover" id="bookTable">
          <thead class="table-secondary">
            <tr>
              <th>#</th>
              <th>Book Name</th>
              <th>Author</th>
              <th>Publisher</th>
              <th>Copies</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <!-- Book rows will go here -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Modal for Add/Edit Book -->
    <div
      class="modal fade"
      id="addBookModal"
      tabindex="-1"
      aria-labelledby="addBookModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="addBookModalLabel">Add New Book</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="bookForm">
              <div class="mb-3">
                <label for="bookName" class="form-label">Book Name</label>
                <input
                  type="text"
                  class="form-control"
                  id="bookName"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="bookAuthor" class="form-label">Author</label>
                <input
                  type="text"
                  class="form-control"
                  id="bookAuthor"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="bookPublisher" class="form-label">Publisher</label>
                <input
                  type="text"
                  class="form-control"
                  id="bookPublisher"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="bookCopies" class="form-label">Copies</label>
                <input
                  type="number"
                  class="form-control"
                  id="bookCopies"
                  required
                  min="0"
                />
              </div>
              <button type="submit" class="btn btn-primary">Save Book</button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script>
      $(document).ready(function () {
        const books = JSON.parse(localStorage.getItem("books")) || [];
        let currentIndex = null; // Track index for editing
        const bookTable = $("#bookTable tbody");

        function loadBooks() {
          bookTable.empty();
          books.forEach((book, index) => {
            bookTable.append(`
              <tr>
                <td>${index + 1}</td>
                <td>${book.name}</td>
                <td>${book.author}</td>
                <td>${book.publisher}</td>
                <td>${book.copies}</td>
                <td>
                  <button class="btn btn-warning btn-sm editBook" data-index="${index}" data-bs-toggle="modal" data-bs-target="#addBookModal">Edit</button>
                  <button class="btn btn-danger btn-sm deleteBook" data-index="${index}">Delete</button>
                </td>
              </tr>
            `);
          });
        }

        loadBooks();

        $("#bookForm").submit(function (e) {
          e.preventDefault();
          const bookName = $("#bookName").val();
          const bookAuthor = $("#bookAuthor").val();
          const bookPublisher = $("#bookPublisher").val();
          const bookCopies = parseInt($("#bookCopies").val());

          if (bookName && bookAuthor && bookPublisher && bookCopies >= 0) {
            if (currentIndex === null) {
              // Add new book
              books.push({
                name: bookName,
                author: bookAuthor,
                publisher: bookPublisher,
                copies: bookCopies,
              });
            } else {
              // Edit existing book
              books[currentIndex] = {
                name: bookName,
                author: bookAuthor,
                publisher: bookPublisher,
                copies: bookCopies,
              };
              currentIndex = null;
            }
            localStorage.setItem("books", JSON.stringify(books));
            loadBooks();
            $("#addBookModal").modal("hide");
            $("#bookForm")[0].reset();
          }
        });

        $("#searchBook").on("input", function () {
          const searchTerm = $(this).val().toLowerCase();
          $("#bookTable tbody tr").each(function () {
            const name = $(this).find("td:nth-child(2)").text().toLowerCase();
            const author = $(this).find("td:nth-child(3)").text().toLowerCase();
            const publisher = $(this)
              .find("td:nth-child(4)")
              .text()
              .toLowerCase();
            $(this).toggle(
              name.includes(searchTerm) ||
                author.includes(searchTerm) ||
                publisher.includes(searchTerm)
            );
          });
        });

        $("#sortBook").click(function () {
          books.sort((a, b) => a.name.localeCompare(b.name));
          localStorage.setItem("books", JSON.stringify(books));
          loadBooks();
        });

        $(document).on("click", ".editBook", function () {
          currentIndex = $(this).data("index");
          const book = books[currentIndex];
          $("#bookName").val(book.name);
          $("#bookAuthor").val(book.author);
          $("#bookPublisher").val(book.publisher);
          $("#bookCopies").val(book.copies);
        });

        $(document).on("click", ".deleteBook", function () {
          const index = $(this).data("index");
          books.splice(index, 1);
          localStorage.setItem("books", JSON.stringify(books));
          loadBooks();
        });
      });
    </script>
  </body>
</html>
